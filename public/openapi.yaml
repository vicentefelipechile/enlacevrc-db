openapi: 3.0.3
info:
  title: EnlaceVRC Database API
  description: |
    Backend service built with Cloudflare Workers that provides a REST API for managing 
    VRChat user profiles, Discord server configurations, and administrative staff.
    
    **Authentication**: All endpoints (except `/docs` and `/openapi.json`) require:
    - `Authorization` header with Bearer token
    - `X-Discord-ID` header with Discord user ID
    - `X-Discord-Name` header with Discord username
    
    **Features**:
    - üîê API Key authentication
    - üë§ Profile management (create, list, update, delete, ban, verify)
    - üí¨ Discord server configuration
    - üë®‚Äçüíº Administrative staff management
    - üìä SQLite database with D1 (Cloudflare)
  version: 1.0.0
  contact:
    name: Vicente
    url: https://github.com/vicentefelipechile/enlacevrc-db
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://enlacevrc-db.vicentefelipechile.workers.dev
    description: Production server
  - url: http://localhost:8787
    description: Local development server

tags:
  - name: Profile
    description: User profile management endpoints
  - name: Discord
    description: Discord server configuration endpoints
  - name: Group
    description: VRChat Group management endpoints
  - name: Staff
    description: Administrative staff management endpoints
  - name: Logs
    description: System logging endpoints (admin only)
  - name: Auth
    description: Authentication and validation endpoints

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: API Key in Bearer token format
    
  parameters:
    DiscordIDHeader:
      name: X-Discord-ID
      in: header
      required: true
      schema:
        type: string
      description: Discord user ID
      example: "123456789012345678"
    
    DiscordNameHeader:
      name: X-Discord-Name
      in: header
      required: true
      schema:
        type: string
      description: Discord username
      example: "YourUsername"

  schemas:
    Profile:
      type: object
      properties:
        discord_id:
          type: string
          description: Discord user ID
          example: "123456789012345678"
        vrchat_id:
          type: string
          description: VRChat user ID
          example: "usr_12345678-1234-1234-1234-123456789012"
        vrchat_name:
          type: string
          description: VRChat display name
          example: "VRChatUser"
        added_at:
          type: string
          format: date-time
          description: Timestamp when profile was created
        updated_at:
          type: string
          format: date-time
          description: Timestamp when profile was last updated
        created_by:
          type: string
          description: Discord ID of user who created this profile
        updated_by:
          type: string
          description: Discord ID of user who last updated this profile
        is_banned:
          type: boolean
          description: Whether the profile is banned
        banned_at:
          type: string
          format: date-time
          description: Timestamp when profile was banned
        banned_reason:
          type: string
          description: Reason for ban
        banned_by:
          type: string
          description: Discord ID of staff who banned this profile
        is_verified:
          type: boolean
          description: Whether the profile is verified
        verification_id:
          type: integer
          description: Verification type ID
        verified_at:
          type: string
          format: date-time
          description: Timestamp when profile was verified
        verified_from:
          type: string
          description: Discord server ID where verification occurred
        verified_by:
          type: string
          description: Discord ID of staff who verified this profile
    
    NewProfile:
      type: object
      required:
        - vrchat_id
        - discord_id
        - vrchat_name
      properties:
        vrchat_id:
          type: string
          example: "usr_12345678-1234-1234-1234-123456789012"
        discord_id:
          type: string
          example: "123456789012345678"
        vrchat_name:
          type: string
          example: "VRChatUser"
    
    VerifyProfileRequest:
      type: object
      required:
        - verification_id
        - verified_from
      properties:
        verification_id:
          type: integer
          description: Verification type ID
          example: 1
        verified_from:
          type: string
          description: Discord server ID
          example: "987654321098765432"
    
    BanProfileRequest:
      type: object
      required:
        - reason
      properties:
        reason:
          type: string
          description: Reason for banning
          example: "ToS violation"
    
    Staff:
      type: object
      properties:
        discord_id:
          type: string
          description: Discord user ID
          example: "123456789012345678"
        discord_name:
          type: string
          description: Discord username
          example: "StaffMember"
        added_at:
          type: string
          format: date-time
          description: Timestamp when staff was added
        added_by:
          type: string
          description: Discord ID of admin who added this staff
    
    NewStaff:
      type: object
      required:
        - discord_id
      properties:
        discord_id:
          type: string
          example: "123456789012345678"
        discord_name:
          type: string
          example: "StaffMember"
    
    UpdateStaffName:
      type: object
      required:
        - discord_name
      properties:
        discord_name:
          type: string
          example: "NewStaffName"
    
    DiscordServer:
      type: object
      properties:
        discord_server_id:
          type: string
          description: Discord server ID
          example: "987654321098765432"
        server_name:
          type: string
          description: Discord server name
          example: "My VRChat Server"
        added_at:
          type: string
          format: date-time
        added_by:
          type: string
          description: Discord ID of user who added this server
    
    DiscordSetting:
      type: object
      properties:
        discord_setting_id:
          type: integer
        discord_server_id:
          type: string
        setting_key:
          type: string
          example: "welcome_channel"
        setting_value:
          type: string
          example: "123456789"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        updated_by:
          type: string
    
    UpdateSettingRequest:
      type: object
      required:
        - setting_key
        - setting_value
      properties:
        setting_key:
          type: string
          example: "welcome_channel"
        setting_value:
          type: string
          example: "123456789"
    
    VRChatGroup:
      type: object
      properties:
        vrchat_group_id:
          type: string
          description: VRChat group ID
          example: "grp_12345678-1234-1234-1234-123456789012"
        discord_server_id:
          type: string
          description: Discord server ID this group belongs to
          example: "987654321098765432"
        group_name:
          type: string
          description: VRChat group name
          example: "My VRChat Group"
        added_at:
          type: string
          format: date-time
        added_by:
          type: string
          description: Discord ID of user who added this group
        updated_at:
          type: string
          format: date-time
        updated_by:
          type: string
          description: Discord ID of user who last updated this group
    
    NewVRChatGroup:
      type: object
      required:
        - vrchat_group_id
        - discord_server_id
        - group_name
      properties:
        vrchat_group_id:
          type: string
          example: "grp_12345678-1234-1234-1234-123456789012"
        discord_server_id:
          type: string
          example: "987654321098765432"
        group_name:
          type: string
          example: "My VRChat Group"
    
    UpdateVRChatGroup:
      type: object
      required:
        - group_name
      properties:
        group_name:
          type: string
          example: "Updated Group Name"
    
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed successfully"
    
    DataResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          description: Response data (structure varies by endpoint)
    
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Error message"

security:
  - BearerAuth: []

paths:
  # ============================================================================
  # PROFILE ENDPOINTS
  # ============================================================================
  
  /profile/new:
    post:
      tags:
        - Profile
      summary: Create a new profile
      description: Creates a new user profile linking VRChat and Discord accounts
      parameters:
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewProfile'
      responses:
        '201':
          description: Profile created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Missing required fields or invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Missing required fields: vrchat_id, discord_id and vrchat_name are required"
        '409':
          description: Profile already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile with this VRChat ID already exists"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Internal Server Error"
  
  /profile/list:
    get:
      tags:
        - Profile
      summary: List all profiles
      description: Retrieves a list of all user profiles
      parameters:
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: List of profiles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Internal Server Error"
  
  /profile/{profileId}/get:
    get:
      tags:
        - Profile
      summary: Get a specific profile
      description: Retrieves a profile by VRChat ID or Discord ID
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: string
          description: VRChat ID or Discord ID
          example: "usr_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Profile data
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/DataResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Profile'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /profile/{profileId}/delete:
    delete:
      tags:
        - Profile
      summary: Delete a profile
      description: Deletes a profile by VRChat ID or Discord ID (requires staff permissions)
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: string
          example: "usr_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Profile deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '403':
          description: Forbidden - requires staff permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Staff permissions required"
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /profile/{profileId}/ban:
    put:
      tags:
        - Profile
      summary: Ban a profile
      description: Bans a profile (requires staff permissions)
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: string
          example: "usr_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BanProfileRequest'
      responses:
        '200':
          description: Profile banned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '403':
          description: Forbidden - requires staff permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Staff permissions required"
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile not found"
        '409':
          description: Profile is already banned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile is already banned"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /profile/{profileId}/unban:
    put:
      tags:
        - Profile
      summary: Unban a profile
      description: Unbans a previously banned profile (requires staff permissions)
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: string
          example: "usr_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Profile unbanned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '403':
          description: Forbidden - requires staff permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Staff permissions required"
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile not found"
        '409':
          description: Profile is not banned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile is not banned"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /profile/{profileId}/verify:
    put:
      tags:
        - Profile
      summary: Verify a profile
      description: Verifies a profile with a specific verification type (requires staff permissions)
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: string
          example: "usr_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyProfileRequest'
      responses:
        '200':
          description: Profile verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Missing required fields or invalid verification type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Missing required field: verification_id"
        '403':
          description: Forbidden - requires staff permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Staff permissions required"
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile not found"
        '409':
          description: Profile is already verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile is already verified"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /profile/{profileId}/unverify:
    put:
      tags:
        - Profile
      summary: Unverify a profile
      description: Removes verification from a profile (requires staff permissions)
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: string
          example: "usr_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Profile unverified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '403':
          description: Forbidden - requires staff permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Staff permissions required"
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile not found"
        '409':
          description: Profile is not verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Profile is not verified"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"

  # ============================================================================
  # DISCORD ENDPOINTS
  # ============================================================================
  
  /discord/add-server:
    post:
      tags:
        - Discord
      summary: Add Discord server
      description: Adds a new Discord server and generates default configurations
      parameters:
        - name: discord_server_id
          in: query
          required: true
          schema:
            type: string
          description: Discord server ID
          example: "987654321098765432"
        - name: discord_server_name
          in: query
          required: true
          schema:
            type: string
          description: Discord server name
          example: "My Server"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '201':
          description: Server added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '409':
          description: Server already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Discord server already exists"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /discord/list-servers:
    get:
      tags:
        - Discord
      summary: List all Discord servers
      description: Retrieves a list of all registered Discord servers
      parameters:
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: List of Discord servers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataResponse'
        '401':
          description: Unauthorized
  
  /discord/new-setting:
    post:
      tags:
        - Discord
      summary: Create a new Discord server setting
      description: "Creates a new Discord server setting global to all servers. Warning: This operation creates a setting that affects all servers and should be used with caution."
      parameters:
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
        - name: setting_key
          in: query
          required: true
          schema:
            type: string
          description: Setting key
          example: "my_setting"
        - name: setting_type
          in: query
          required: true
          schema:
            type: string
          description: Setting type
          example: "string"
        - name: default_value
          in: query
          required: true
          schema:
            type: string
          description: Default value
          example: "my_value"
      responses:
        '201':
          description: Setting created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
  
  /discord/{serverId}/get-setting:
    get:
      tags:
        - Discord
      summary: Get Discord server settings
      description: Retrieves settings for a specific Discord server. Use query parameter `getallsettings=true` to get all settings, or `setting_key` to get a specific setting.
      parameters:
        - name: serverId
          in: path
          required: true
          schema:
            type: string
          example: "987654321098765432"
        - name: getallsettings
          in: query
          required: false
          schema:
            type: boolean
          description: Get all settings for the server
        - name: setting_key
          in: query
          required: false
          schema:
            type: string
          description: Specific setting key to retrieve
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Server settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataResponse'
        '400':
          description: Missing required parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Missing required parameter: setting_key"
        '404':
          description: Server or setting not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Discord server not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /discord/{serverId}/list-settings:
    get:
      tags:
        - Discord
      summary: List Discord server settings
      description: Retrieves settings for a specific Discord server
      parameters:
        - name: serverId
          in: path
          required: true
          schema:
            type: string
          example: "987654321098765432"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
        - name: limit
          in: query
          required: false
          schema:
            type: integer
          description: Limit the number of results
        - name: start_date
          in: query
          required: false
          schema:
            type: string
          description: Start date for filtering
        - name: end_date
          in: query
          required: false
          schema:
            type: string
          description: End date for filtering
        - name: created_by
          in: query
          required: false
          schema:
            type: string
          description: Who created the setting (Dev Only)
      responses:
        '200':
          description: Server settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataResponse'
        '404':
          description: Server not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Discord server not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /discord/{serverId}/update-setting:
    put:
      tags:
        - Discord
      summary: Update Discord server setting
      description: Updates a specific setting for a Discord server
      parameters:
        - name: serverId
          in: path
          required: true
          schema:
            type: string
          example: "987654321098765432"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSettingRequest'
      responses:
        '200':
          description: Setting updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "Setting updated successfully"
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Missing required fields: setting_key and setting_value are required"
        '404':
          description: Server not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Discord server not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /discord/{serverId}/exists-server:
    get:
      tags:
        - Discord
      summary: Check if Discord server exists
      description: Verifies if a Discord server is registered in the database
      parameters:
        - name: serverId
          in: path
          required: true
          schema:
            type: string
          example: "987654321098765432"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Server exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  exists:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"

  # ============================================================================
  # GROUP ENDPOINTS
  # ============================================================================
  
  /group/add-group:
    post:
      tags:
        - Group
      summary: Add VRChat group to Discord server
      description: Associates a VRChat group with a Discord server (requires staff permissions)
      parameters:
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewVRChatGroup'
      responses:
        '201':
          description: Group added successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/VRChatGroup'
              example:
                success: true
                message: "VRChat group added successfully"
                data:
                  vrchat_group_id: "grp_12345678-1234-1234-1234-123456789012"
                  discord_server_id: "987654321098765432"
                  group_name: "My VRChat Group"
                  added_at: "2024-01-15T10:30:00Z"
                  added_by: "123456789012345678"
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Missing required fields: vrchat_group_id, discord_server_id, group_name"
        '404':
          description: Discord server does not exist
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Discord server does not exist"
        '409':
          description: Group already exists for this server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "VRChat group already exists for this Discord server"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /discord/{serverId}/list-groups:
    get:
      tags:
        - Group
      summary: List all VRChat groups for a Discord server
      description: Retrieves all VRChat groups associated with a Discord server
      parameters:
        - name: serverId
          in: path
          required: true
          schema:
            type: string
          description: Discord server ID
          example: "987654321098765432"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: List of VRChat groups
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      discord_server_id:
                        type: string
                        example: "987654321098765432"
                      groups:
                        type: array
                        items:
                          $ref: '#/components/schemas/VRChatGroup'
                      total:
                        type: integer
                        description: Total number of groups
                        example: 3
        '404':
          description: Discord server not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Discord server not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /group/{groupId}/get-group:
    get:
      tags:
        - Group
      summary: Get VRChat group details
      description: Retrieves detailed information about a specific VRChat group
      parameters:
        - name: groupId
          in: path
          required: true
          schema:
            type: string
          description: VRChat group ID
          example: "grp_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Group details with server information
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: '#/components/schemas/VRChatGroup'
                      - type: object
                        properties:
                          server_name:
                            type: string
                            description: Discord server name
                            example: "My VRChat Server"
        '404':
          description: VRChat group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "VRChat group not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /group/{groupId}/get-server:
    get:
      tags:
        - Group
      summary: Get Discord server for a VRChat group
      description: Retrieves the Discord server associated with a VRChat group
      parameters:
        - name: groupId
          in: path
          required: true
          schema:
            type: string
          description: VRChat group ID
          example: "grp_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Discord server information
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/DiscordServer'
        '404':
          description: VRChat group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "VRChat group not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /group/{groupId}/update-group:
    put:
      tags:
        - Group
      summary: Update VRChat group name
      description: Updates the name of a VRChat group (requires staff permissions)
      parameters:
        - name: groupId
          in: path
          required: true
          schema:
            type: string
          description: VRChat group ID
          example: "grp_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateVRChatGroup'
      responses:
        '200':
          description: Group updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/VRChatGroup'
              example:
                success: true
                message: "VRChat group updated successfully"
                data:
                  vrchat_group_id: "grp_12345678-1234-1234-1234-123456789012"
                  group_name: "Updated Group Name"
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Missing required field: group_name"
        '404':
          description: VRChat group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "VRChat group not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /group/{groupId}/delete-group:
    delete:
      tags:
        - Group
      summary: Delete VRChat group
      description: Removes a VRChat group from a Discord server (requires staff permissions)
      parameters:
        - name: groupId
          in: path
          required: true
          schema:
            type: string
          description: VRChat group ID
          example: "grp_12345678-1234-1234-1234-123456789012"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Group deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          vrchat_group_id:
                            type: string
                            example: "grp_12345678-1234-1234-1234-123456789012"
              example:
                success: true
                message: "VRChat group deleted successfully"
                data:
                  vrchat_group_id: "grp_12345678-1234-1234-1234-123456789012"
        '404':
          description: VRChat group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "VRChat group not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"

  # ============================================================================
  # STAFF ENDPOINTS
  # ============================================================================
  
  /staff/new:
    post:
      tags:
        - Staff
      summary: Add new staff member
      description: Creates a new staff member (requires admin permissions)
      parameters:
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewStaff'
      responses:
        '201':
          description: Staff member added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Missing required fields: discord_id"
        '403':
          description: Forbidden - requires admin permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Admin permissions required"
        '409':
          description: Staff member already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Staff member already exists"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /staff/list:
    get:
      tags:
        - Staff
      summary: List all staff members
      description: Retrieves a list of all staff members
      parameters:
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: List of staff members
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /staff/{discordId}/get:
    get:
      tags:
        - Staff
      summary: Get staff member information
      description: Retrieves information about a specific staff member
      parameters:
        - name: discordId
          in: path
          required: true
          schema:
            type: string
          description: Discord ID of the staff member
          example: "123456789012345678"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Staff member data
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/DataResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Staff'
        '404':
          description: Staff member not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Staff member not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /staff/{discordId}/update_name:
    put:
      tags:
        - Staff
      summary: Update staff member name
      description: Updates the Discord name of a staff member (requires admin permissions)
      parameters:
        - name: discordId
          in: path
          required: true
          schema:
            type: string
          example: "123456789012345678"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateStaffName'
      responses:
        '200':
          description: Staff name updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Missing required fields: discord_name"
        '403':
          description: Forbidden - requires admin permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Admin permissions required"
        '404':
          description: Staff member not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Staff member not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"
  
  /staff/{discordId}/delete:
    delete:
      tags:
        - Staff
      summary: Remove staff member
      description: Deletes a staff member (requires admin permissions)
      parameters:
        - name: discordId
          in: path
          required: true
          schema:
            type: string
          example: "123456789012345678"
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: Staff member deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '403':
          description: Forbidden - requires admin permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Admin permissions required"
        '404':
          description: Staff member not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Staff member not found"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"

  # ============================================================================
  # LOGS ENDPOINTS
  # ============================================================================
  
  /logs:
    get:
      tags:
        - Logs
      summary: Get system logs
      description: Retrieves system logs (requires admin permissions)
      parameters:
        - $ref: '#/components/parameters/DiscordIDHeader'
        - $ref: '#/components/parameters/DiscordNameHeader'
      responses:
        '200':
          description: System logs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataResponse'
        '403':
          description: Forbidden - requires admin permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Forbidden: Admin permissions required"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Unauthorized"

  # ============================================================================
  # AUTH ENDPOINTS
  # ============================================================================
  
  /auth/validate-admin:
    get:
      tags:
        - Auth
      summary: Validate admin access
      description: Checks if a user has admin permissions (public endpoint, no Bearer auth required)
      security: []
      parameters:
        - name: discord_id
          in: query
          required: true
          schema:
            type: string
          description: Discord ID to validate
          example: "123456789012345678"
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  isAdmin:
                    type: boolean
